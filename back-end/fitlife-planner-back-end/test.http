###############################################################################
# FitLife Planner - Complete API Test Suite
# Comprehensive test coverage for all endpoints
# Run sequentially from top to bottom
###############################################################################

@host = http://localhost:5000
@email = test{{$timestamp}}@example.com
@password = Password123!
@username = user{{$timestamp}}

###############################################################################
# 1. AUTHENTICATION & ACCOUNT
###############################################################################

### 1.1 Create Account
POST {{host}}/account
Content-Type: application/json

{
  "username": "{{username}}",
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    client.test("Account created", () => {
        client.assert(response.status === 201 || response.status === 200);
        client.assert(response.body.success === true);
    });
    if (response.body.data) {
        client.global.set("userId", response.body.data.id);
        console.log("âœ“ Account created - User ID:", response.body.data.id);
    }
%}

### 1.2 Login
POST {{host}}/auth/login
Content-Type: application/json

{
  "email": "{{email}}",
  "password": "{{password}}"
}

> {%
    client.test("Login successful", () => {
        client.assert(response.status === 200);
        client.assert(response.body.success === true);
        client.assert(response.body.data.token !== undefined);
    });
    if (response.body.data) {
        client.global.set("token", response.body.data.token);
        client.global.set("refreshToken", response.body.data.refreshToken);
        console.log("âœ“ Login successful - Token saved");
    }
%}

### 1.3 Get Account Info
GET {{host}}/account
Authorization: Bearer {{token}}

> {%
    client.test("Get account info", () => {
        client.assert(response.status === 200);
        client.assert(response.body.success === true);
    });
    console.log("âœ“ Account info retrieved");
%}

### 1.4 Refresh Token
POST {{host}}/auth/refresh
Content-Type: application/json

{
  "refreshToken": "{{refreshToken}}"
}

> {%
    if (response.status === 201 || response.status === 200) {
        if (response.body.data && response.body.data.token) {
            client.global.set("token", response.body.data.token);
            console.log("âœ“ Token refreshed");
        }
    }
%}

###############################################################################
# 2. PROFILE
###############################################################################

### 2.1 Get My Profile
GET {{host}}/profile
Authorization: Bearer {{token}}

> {%
    if (response.body.data) {
        client.global.set("profileId", response.body.data.profileId);
        console.log("âœ“ Profile retrieved - ID:", response.body.data.profileId);
    } else {
        console.log("â„¹ Profile not found (will be created with BMI)");
    }
%}

### 2.2 Update Profile
PUT {{host}}/profile
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "displayName": "Test User {{$timestamp}}",
  "avatarUrl": "https://i.pravatar.cc/150?img={{$randomInt}}",
  "birthDate": "1995-05-15T00:00:00Z",
  "gender": 0,
  "bio": "Fitness enthusiast testing the FitLife Planner app"
}

> {%
    client.test("Profile updated", () => {
        client.assert(response.status === 200);
    });
    if (response.body.data) {
        client.global.set("profileId", response.body.data.profileId);
        console.log("âœ“ Profile updated - ID:", response.body.data.profileId);
    }
%}

### 2.3 Get All Profiles (Paginated)
GET {{host}}/profile/all?PageNumber=1&PageSize=10
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Profiles list retrieved");
%}

###############################################################################
# 3. BMI & NUTRITION PLANNING (CRITICAL)
###############################################################################

### 3.1 Calculate BMI
POST {{host}}/bmi/calculate
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "heightCm": 175,
  "weightKg": 70
}

> {%
    client.test("BMI calculated", () => {
        client.assert(response.status === 200);
        client.assert(response.body.success === true);
        client.assert(response.body.data.bmi !== undefined);
    });
    if (response.body.data) {
        client.global.set("calculatedBmi", response.body.data.bmi);
        client.global.set("bmiCategory", response.body.data.category);
        console.log("âœ“ BMI calculated:", response.body.data.bmi, "-", response.body.data.category);
    }
%}

### 3.2 Create BMI Record & Choose Plan
POST {{host}}/bmi/me
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "practiceLevel": 2,
  "activityFactor": 1.55
}

> {%
    client.test("BMI record created", () => {
        client.assert(response.status === 201 || response.status === 200);
        client.assert(response.body.success === true);
    });
    if (response.body.data) {
        client.global.set("bmiRecordId", response.body.data.bmiRecordId || response.body.data.id);
        client.global.set("nutritionPlanId", response.body.data.nutritionPlanId);
        console.log("âœ“ BMI record created - ID:", response.body.data.bmiRecordId || response.body.data.id);
        console.log("  Nutrition Plan ID:", response.body.data.nutritionPlanId);
    }
%}

### 3.3 Get My BMI Records
GET {{host}}/bmi/me
Authorization: Bearer {{token}}

> {%
    client.test("BMI records retrieved", () => {
        client.assert(response.status === 200);
    });
    console.log("âœ“ BMI records retrieved");
%}

###############################################################################
# 4. FOOD ITEMS
###############################################################################

### 4.1 Create Food Item - Chicken
POST {{host}}/food-items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Grilled Chicken Breast",
  "servingSize": "100g",
  "servingAmount": 1,
  "caloriesKcal": 165,
  "proteinG": 31,
  "carbsG": 0,
  "fatG": 3.6,
  "fiberG": 0,
  "sodiumMg": 74,
  "micronutrients": "{}"
}

> {%
    if (response.body.data) {
        client.global.set("foodItemId1", response.body.data.id);
        console.log("âœ“ Food item created:", response.body.data.name);
    }
%}

### 4.2 Create Food Item - Rice
POST {{host}}/food-items
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Brown Rice",
  "servingSize": "100g",
  "servingAmount": 1,
  "caloriesKcal": 112,
  "proteinG": 2.6,
  "carbsG": 24,
  "fatG": 0.9,
  "fiberG": 1.8,
  "sodiumMg": 5,
  "micronutrients": "{}"
}

> {%
    if (response.body.data) {
        client.global.set("foodItemId2", response.body.data.id);
        console.log("âœ“ Food item created:", response.body.data.name);
    }
%}

### 4.3 Get All Food Items
GET {{host}}/food-items?PageNumber=1&PageSize=20
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Food items list retrieved");
%}

### 4.4 Get Food Item by ID
GET {{host}}/food-items/{{foodItemId1}}
Authorization: Bearer {{token}}

### 4.5 Update Food Item
PUT {{host}}/food-items/{{foodItemId1}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Grilled Chicken Breast (Organic)",
  "servingSize": "150g",
  "servingAmount": 1,
  "caloriesKcal": 248,
  "proteinG": 46.5,
  "carbsG": 0,
  "fatG": 5.4,
  "fiberG": 0,
  "sodiumMg": 111,
  "micronutrients": "{}"
}

> {%
    console.log("âœ“ Food item updated");
%}

###############################################################################
# 5. WORKOUTS
###############################################################################

### 5.1 Create Workout
POST {{host}}/workouts
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Upper Body Strength",
  "description": "Chest, shoulders, and triceps workout",
  "durationMinutes": 60,
  "caloriesBurned": 300,
  "exercises": "[{\"name\": \"Bench Press\", \"sets\": 4, \"reps\": 10}]",
  "scheduledFor": "2024-12-05T10:00:00Z"
}

> {%
    if (response.body.data) {
        client.global.set("workoutId", response.body.data.id);
        console.log("âœ“ Workout created - ID:", response.body.data.id);
    }
%}

### 5.2 Get My Workouts
GET {{host}}/workouts/me
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Workouts retrieved");
%}

### 5.3 Get Workout by ID
GET {{host}}/workouts/{{workoutId}}
Authorization: Bearer {{token}}

### 5.4 Update Workout
PUT {{host}}/workouts/{{workoutId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "name": "Upper Body Strength (Enhanced)",
  "description": "Added back exercises",
  "durationMinutes": 75,
  "caloriesBurned": 350,
  "exercises": "[{\"name\": \"Bench Press\", \"sets\": 4, \"reps\": 10}, {\"name\": \"Pull-ups\", \"sets\": 3, \"reps\": 8}]",
  "scheduledFor": "2024-12-05T10:00:00Z"
}

> {%
    console.log("âœ“ Workout updated");
%}

###############################################################################
# 6. PROGRESS TRACKING
###############################################################################

### 6.1 Create Progress Entry - Weight
POST {{host}}/progress
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "type": "weight",
  "value": 70.5,
  "unit": "kg",
  "notes": "Morning weight after workout",
  "recordedAt": "2024-12-01T08:00:00Z"
}

> {%
    if (response.body.data) {
        client.global.set("progressId", response.body.data.id);
        console.log("âœ“ Progress entry created - ID:", response.body.data.id);
    }
%}

### 6.2 Get My Progress Entries
GET {{host}}/progress/me
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Progress entries retrieved");
%}

### 6.3 Update Progress Entry
PUT {{host}}/progress/{{progressId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "type": "weight",
  "value": 70.3,
  "unit": "kg",
  "notes": "Corrected measurement",
  "recordedAt": "2024-12-01T08:00:00Z"
}

> {%
    console.log("âœ“ Progress entry updated");
%}

###############################################################################
# 7. CHALLENGES
###############################################################################

### 7.1 Create Challenge
POST {{host}}/challenges
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "30-Day Plank Challenge",
  "description": "Build core strength with daily planks",
  "type": "fitness",
  "goal": "Hold plank for 5 minutes",
  "startDate": "2024-12-01T00:00:00Z",
  "endDate": "2024-12-31T23:59:59Z",
  "rules": "{\"daily_target\": \"60 seconds\", \"progression\": \"increase 5s daily\"}"
}

> {%
    if (response.body.data) {
        client.global.set("challengeId", response.body.data.id);
        console.log("âœ“ Challenge created - ID:", response.body.data.id);
    }
%}

### 7.2 Get All Challenges
GET {{host}}/challenges?PageNumber=1&PageSize=10
Authorization: Bearer {{token}}

### 7.3 Join Challenge
POST {{host}}/challenges/{{challengeId}}/join
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Joined challenge");
%}

### 7.4 Get My Challenges
GET {{host}}/challenges/me
Authorization: Bearer {{token}}

###############################################################################
# 8. POSTS (SOCIAL)
###############################################################################

### 8.1 Create Post
POST {{host}}/post
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "First 5K Run!",
  "content": "Just completed my first 5K run! Feeling amazing! ðŸƒâ€â™‚ï¸",
  "media": "https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=800"
}

> {%
    if (response.body.data) {
        client.global.set("postId", response.body.data.postId || response.body.data.id);
        console.log("âœ“ Post created - ID:", response.body.data.postId || response.body.data.id);
    }
%}

### 8.2 Get My Posts
GET {{host}}/post
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ My posts retrieved");
%}

### 8.3 Get All Posts (Paginated)
GET {{host}}/post/all?PageNumber=1&PageSize=20
Authorization: Bearer {{token}}

### 8.4 Get All Posts by Like
GET {{host}}/post/all-by-like?PageNumber=1&PageSize=20
Authorization: Bearer {{token}}

### 8.5 Get Post by ID
GET {{host}}/post/{{postId}}
Authorization: Bearer {{token}}

### 8.6 Update Post
PUT {{host}}/post/{{postId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "title": "First 5K Run - New PR!",
  "content": "Just completed my first 5K run! New personal best: 25:30! ðŸƒâ€â™‚ï¸ðŸŽ‰",
  "media": "https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=800"
}

> {%
    console.log("âœ“ Post updated");
%}

###############################################################################
# 9. FOLLOWERS (SOCIAL)
###############################################################################

### 9.1 Create Second User for Testing
POST {{host}}/account
Content-Type: application/json

{
  "username": "user2{{$timestamp}}",
  "email": "test2{{$timestamp}}@example.com",
  "password": "{{password}}"
}

> {%
    if (response.body.data) {
        client.global.set("user2Id", response.body.data.id);
        console.log("âœ“ Second user created - ID:", response.body.data.id);
    }
%}

### 9.2 Follow User
POST {{host}}/api/followers/{{user2Id}}/follow
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Followed user");
%}

### 9.3 Get My Followers
GET {{host}}/api/followers/followers?page=1&pageSize=20
Authorization: Bearer {{token}}

### 9.4 Get My Following
GET {{host}}/api/followers/following?page=1&pageSize=20
Authorization: Bearer {{token}}

### 9.5 Get Follower Stats
GET {{host}}/api/followers/stats
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Follower stats retrieved");
%}

### 9.6 Get Follow Suggestions
GET {{host}}/api/followers/suggestions?limit=10
Authorization: Bearer {{token}}

### 9.7 Get Mutual Friends
GET {{host}}/api/followers/mutual/{{user2Id}}
Authorization: Bearer {{token}}

###############################################################################
# 10. NOTIFICATIONS
###############################################################################

### 10.1 Get My Notifications
GET {{host}}/notifications/me?PageNumber=1&PageSize=20
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Notifications retrieved");
%}

###############################################################################
# 11. AI RECOMMENDATIONS
###############################################################################

### 11.1 Get Personalized Plan
GET {{host}}/api/recommendations/personalized-plan
Authorization: Bearer {{token}}

> {%
    if (response.body.data) {
        console.log("âœ“ Personalized plan generated");
        console.log("  BMI:", response.body.data.currentBMI);
        console.log("  Target Calories:", response.body.data.targetCalories);
    }
%}

### 11.2 Get Meal Recommendations
GET {{host}}/api/recommendations/meals?targetCalories=2000&mealType=breakfast&limit=10
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Meal recommendations retrieved");
%}

### 11.3 Get Workout Recommendations
GET {{host}}/api/recommendations/workouts?bmi=22.5&goal=muscle_gain&fitnessLevel=intermediate&limit=5
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Workout recommendations retrieved");
%}

### 11.4 Get Daily Tip
GET {{host}}/api/recommendations/daily-tip
Authorization: Bearer {{token}}

> {%
    if (response.body.data) {
        console.log("âœ“ Daily tip:", response.body.data.tip);
    }
%}

###############################################################################
# 12. EXERCISE LIBRARY
###############################################################################

### 12.1 Get All Exercises
GET {{host}}/exercise-library?PageNumber=1&PageSize=20
Authorization: Bearer {{token}}

> {%
    if (response.body.data && response.body.data.length > 0) {
        client.global.set("exerciseId", response.body.data[0].id);
        console.log("âœ“ Exercises retrieved");
    }
%}

### 12.2 Search Exercises
GET {{host}}/exercise-library/search?query=bench&PageNumber=1&PageSize=10
Authorization: Bearer {{token}}

### 12.3 Get Exercise by ID
GET {{host}}/exercise-library/{{exerciseId}}
Authorization: Bearer {{token}}

###############################################################################
# 13. WORKOUT SCHEDULES
###############################################################################

### 13.1 Create Workout Schedule
POST {{host}}/workout-schedules
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "workoutId": "{{workoutId}}",
  "scheduledFor": "2024-12-06T10:00:00Z",
  "isRecurring": true,
  "recurrencePattern": "weekly"
}

> {%
    if (response.body.data) {
        client.global.set("scheduleId", response.body.data.id);
        console.log("âœ“ Workout schedule created - ID:", response.body.data.id);
    }
%}

### 13.2 Get My Workout Schedules
GET {{host}}/workout-schedules/me
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Workout schedules retrieved");
%}

### 13.3 Update Workout Schedule
PUT {{host}}/workout-schedules/{{scheduleId}}
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "workoutId": "{{workoutId}}",
  "scheduledFor": "2024-12-07T10:00:00Z",
  "isRecurring": true,
  "recurrencePattern": "daily"
}

> {%
    console.log("âœ“ Workout schedule updated");
%}

###############################################################################
# 14. NUTRITION PLANS
###############################################################################

### 14.1 Get My Nutrition Plan
GET {{host}}/nutrition-plans/me
Authorization: Bearer {{token}}

> {%
    console.log("âœ“ Nutrition plan retrieved");
%}

### 14.2 Get Nutrition Plan by ID
GET {{host}}/nutrition-plans/{{nutritionPlanId}}
Authorization: Bearer {{token}}

### 14.3 Add Food to Nutrition Plan
POST {{host}}/nutrition-plans/{{nutritionPlanId}}/foods
Authorization: Bearer {{token}}
Content-Type: application/json

{
  "foodItemId": "{{foodItemId1}}",
  "servings": 1.5,
  "mealType": "lunch"
}

> {%
    console.log("âœ“ Food added to nutrition plan");
%}

###############################################################################
# 15. ADMIN ENDPOINTS (May require admin role)
###############################################################################

### 15.1 Seed Nutrition Data
POST {{host}}/api/admin/seed/nutrition-data
Authorization: Bearer {{token}}

> {%
    if (response.status === 200 && response.body.success) {
        console.log("âœ“ Nutrition data seeded:", response.body.data.itemsSeeded, "items");
    } else if (response.status === 403) {
        console.log("â„¹ Admin endpoint - requires admin role");
    }
%}

###############################################################################
# 16. CLEANUP (DELETE OPERATIONS)
###############################################################################

### 16.1 Delete Post
DELETE {{host}}/post/{{postId}}
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Post deleted");
    }
%}

### 16.2 Delete Progress Entry
DELETE {{host}}/progress/{{progressId}}
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Progress entry deleted");
    }
%}

### 16.3 Delete Workout
DELETE {{host}}/workouts/{{workoutId}}
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Workout deleted");
    }
%}

### 16.4 Delete Food Items
DELETE {{host}}/food-items/{{foodItemId1}}
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Food item 1 deleted");
    }
%}

###
DELETE {{host}}/food-items/{{foodItemId2}}
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Food item 2 deleted");
    }
%}

### 16.5 Unfollow User
DELETE {{host}}/api/followers/{{user2Id}}/unfollow
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Unfollowed user");
    }
%}

### 16.6 Delete Workout Schedule
DELETE {{host}}/workout-schedules/{{scheduleId}}
Authorization: Bearer {{token}}

> {%
    if (response.status === 200) {
        console.log("âœ“ Workout schedule deleted");
    }
%}

###############################################################################
# TEST SUMMARY
# âœ“ All major endpoints covered
# âœ“ BMI/calculate and BMI/me included
# âœ“ Sequential flow: Account â†’ Profile â†’ BMI â†’ Features â†’ Cleanup
# âœ“ Variables auto-saved for chaining requests
###############################################################################
